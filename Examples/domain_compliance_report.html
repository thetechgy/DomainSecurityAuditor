<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Domain Security Compliance Report</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f7fa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header .meta {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .report-actions {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 10px;
            margin: 0 0 16px;
        }

        .action-button {
            padding: 8px 12px;
            background: white;
            color: #1e3a8a;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 1px 4px rgba(0,0,0,0.06);
            transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease;
        }

        .action-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            background: #f3f4f6;
        }

        .action-button[aria-pressed="true"] {
            background: #e0e7ff;
            color: #1e3a8a;
            border-color: #c7d2fe;
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
        }

        .back-to-top-wrapper {
            display: flex;
            justify-content: flex-end;
            margin-top: 16px;
        }

        .back-to-top {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            color: #1e3a8a;
            font-weight: 700;
            text-decoration: none;
            box-shadow: 0 1px 4px rgba(0,0,0,0.06);
            transition: background-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
        }

        .back-to-top:hover {
            background: #f3f4f6;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
            color: white;
        }

        .card-icon.passed { background-color: #10b981; }
        .card-icon.failed { background-color: #ef4444; }
        .card-icon.warning { background-color: #f59e0b; }
        .card-icon.info { background-color: #3b82f6; }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #374151;
        }

        .card-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .card-value.passed { color: #10b981; }
        .card-value.failed { color: #ef4444; }
        .card-value.warning { color: #f59e0b; }

        .card-subtitle {
            color: #6b7280;
            font-size: 0.9rem;
        }

        .domain-results {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 30px;
        }

        .domain-header {
            background: #f8fafc;
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
        }

        .domain-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .domain-name {
            font-size: 1.5rem;
            font-weight: 600;
            color: #374151;
        }

        .domain-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .domain-status.passed {
            background-color: #d1fae5;
            color: #065f46;
        }

        .domain-status.failed {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .domain-status.warning {
            background-color: #fef3c7;
            color: #92400e;
        }

        .protocol-section {
            border-bottom: 1px solid #e5e7eb;
        }

        .protocol-header {
            background: #f9fafb;
            padding: 15px 20px;
            cursor: pointer;
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .protocol-header:hover {
            background: #f3f4f6;
        }

        .protocol-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: #374151;
        }

        .protocol-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-badge.passed {
            background-color: #d1fae5;
            color: #065f46;
        }

        .status-badge.failed {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .status-badge.warning {
            background-color: #fef3c7;
            color: #92400e;
        }

        .status-badge.skipped {
            background-color: #f3f4f6;
            color: #6b7280;
        }

        .protocol-details {
            display: none;
            padding: 0;
        }

        .protocol-details.expanded {
            display: block;
        }

        .test-result {
            padding: 15px 20px;
            border-bottom: 1px solid #f3f4f6;
        }

        .test-result:last-child {
            border-bottom: none;
        }

        .test-header {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 10px;
        }

        .test-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            color: white;
            flex-shrink: 0;
        }

        .test-content {
            flex: 1;
        }

        .test-name {
            font-weight: 600;
            color: #374151;
            margin-bottom: 5px;
        }

        .test-message {
            color: #6b7280;
            margin-bottom: 10px;
        }

        .test-recommendation {
            background: #f8fafc;
            padding: 12px;
            border-radius: 6px;
            border-left: 4px solid #3b82f6;
            margin-bottom: 10px;
        }

        .test-recommendation .label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 5px;
        }

        .test-recommendation .text {
            color: #6b7280;
        }

        .test-references {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .reference-link {
            padding: 4px 8px;
            background: #e5e7eb;
            color: #374151;
            text-decoration: none;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
            transition: background-color 0.2s ease;
        }

        .reference-link:hover {
            background: #d1d5db;
        }

        .chevron {
            transition: transform 0.2s ease;
        }

        .chevron.expanded {
            transform: rotate(90deg);
        }

        .footer {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            color: #6b7280;
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .detail-item {
            background: #f9fafb;
            padding: 10px;
            border-radius: 6px;
        }

        .detail-label {
            font-size: 0.8rem;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 2px;
        }

        .detail-value {
            font-weight: 600;
            color: #374151;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .summary-cards {
                grid-template-columns: 1fr;
            }

            .domain-title {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Domain Security Compliance Report</h1>
            <div class="meta">
                Generated on: September 4, 2025, 2:30 PM EDT<br>
                Framework Version: 1.0.0 | Test Suite: Baseline Email Security v1.2
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="summary-cards">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon passed">✓</div>
                    <div class="card-title">Domains Passed</div>
                </div>
                <div class="card-value passed">2</div>
                <div class="card-subtitle">Full compliance achieved</div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-icon failed">✗</div>
                    <div class="card-title">Domains Failed</div>
                </div>
                <div class="card-value failed">1</div>
                <div class="card-subtitle">Critical issues found</div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-icon warning">⚠</div>
                    <div class="card-title">Warnings</div>
                </div>
                <div class="card-value warning">3</div>
                <div class="card-subtitle">Recommendations available</div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-icon info">ℹ</div>
                    <div class="card-title">Total Tests</div>
                </div>
                <div class="card-value">42</div>
                <div class="card-subtitle">Across 3 domains</div>
            </div>
        </div>

        <!-- Report Controls -->
        <div class="report-actions">
            <button type="button" class="action-button" id="toggle-all-sections" aria-pressed="false">Expand all sections</button>
        </div>

        <!-- Domain Results -->
        <div class="domain-results">
            <div class="domain-header">
                <div class="domain-title">
                    <div class="domain-name">example.com</div>
                    <div class="domain-status passed">PASSED</div>
                </div>
                <div style="margin-top: 10px; color: #6b7280;">
                    Production Domain • Last Updated: 2 hours ago • 14 tests executed
                </div>
            </div>

            <!-- SPF Section -->
            <div class="protocol-section">
                <div class="protocol-header" onclick="toggleSection('spf-example')">
                    <div class="protocol-name">SPF (Sender Policy Framework)</div>
                    <div class="protocol-status">
                        <span class="status-badge passed">3 Passed</span>
                        <span class="chevron" id="chevron-spf-example">▶</span>
                    </div>
                </div>
                <div class="protocol-details" id="spf-example">
                    <div class="test-result">
                        <div class="test-header">
                            <div class="test-icon passed">✓</div>
                            <div class="test-content">
                                <div class="test-name">SPF Record Presence</div>
                                <div class="test-message">SPF record found and properly configured</div>
                                <div class="details-grid">
                                    <div class="detail-item">
                                        <div class="detail-label">Record Value</div>
                                        <div class="detail-value">v=spf1 include:_spf.google.com -all</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">DNS Lookups</div>
                                        <div class="detail-value">2 of 10 allowed</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">TTL</div>
                                        <div class="detail-value">3600 seconds</div>
                                    </div>
                                </div>
                                <div class="test-references">
                                    <a href="https://tools.ietf.org/html/rfc7208" class="reference-link">RFC 7208</a>
                                    <a href="#" class="reference-link">M3AAWG Best Practices</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="test-result">
                        <div class="test-header">
                            <div class="test-icon passed">✓</div>
                            <div class="test-content">
                                <div class="test-name">Terminal Mechanism Validation</div>
                                <div class="test-message">Hard fail (-all) mechanism properly configured</div>
                                <div class="test-references">
                                    <a href="https://tools.ietf.org/html/rfc7208#section-5.1" class="reference-link">RFC 7208 §5.1</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="test-result">
                        <div class="test-header">
                            <div class="test-icon passed">✓</div>
                            <div class="test-content">
                                <div class="test-name">DNS Lookup Limit</div>
                                <div class="test-message">Within 10 DNS lookup limit (2 lookups used)</div>
                                <div class="test-references">
                                    <a href="https://tools.ietf.org/html/rfc7208#section-4.6.4" class="reference-link">RFC 7208 §4.6.4</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- DMARC Section -->
            <div class="protocol-section">
                <div class="protocol-header" onclick="toggleSection('dmarc-example')">
                    <div class="protocol-name">DMARC (Domain-based Message Authentication)</div>
                    <div class="protocol-status">
                        <span class="status-badge passed">2 Passed</span>
                        <span class="status-badge warning">1 Warning</span>
                        <span class="chevron" id="chevron-dmarc-example">▶</span>
                    </div>
                </div>
                <div class="protocol-details" id="dmarc-example">
                    <div class="test-result">
                        <div class="test-header">
                            <div class="test-icon passed">✓</div>
                            <div class="test-content">
                                <div class="test-name">DMARC Policy Presence</div>
                                <div class="test-message">DMARC record found with quarantine policy</div>
                                <div class="details-grid">
                                    <div class="detail-item">
                                        <div class="detail-label">Policy</div>
                                        <div class="detail-value">p=quarantine</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Subdomain Policy</div>
                                        <div class="detail-value">sp=quarantine</div>
                                    </div>
                                </div>
                                <div class="test-references">
                                    <a href="https://tools.ietf.org/html/rfc7489" class="reference-link">RFC 7489</a>
                                    <a href="https://dmarc.org/wiki/FAQ" class="reference-link">DMARC.org</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="test-result">
                        <div class="test-header">
                            <div class="test-icon warning">⚠</div>
                            <div class="test-content">
                                <div class="test-name">DMARC Policy Strength</div>
                                <div class="test-message">Policy is set to quarantine; consider upgrading to reject for maximum protection</div>
                                <div class="test-recommendation">
                                    <div class="label">Recommendation:</div>
                                    <div class="text">After monitoring DMARC reports for 2-4 weeks and ensuring legitimate mail passes authentication, consider upgrading to p=reject for maximum anti-spoofing protection.</div>
                                </div>
                                <div class="test-references">
                                    <a href="https://dmarc.org/wiki/FAQ#Why_should_I_deploy_DMARC.3F" class="reference-link">DMARC Deployment Guide</a>
                                    <a href="#" class="reference-link">M3AAWG DMARC Best Practices</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- DKIM Section -->
            <div class="protocol-section">
                <div class="protocol-header" onclick="toggleSection('dkim-example')">
                    <div class="protocol-name">DKIM (DomainKeys Identified Mail)</div>
                    <div class="protocol-status">
                        <span class="status-badge passed">2 Passed</span>
                        <span class="chevron" id="chevron-dkim-example">▶</span>
                    </div>
                </div>
                <div class="protocol-details" id="dkim-example">
                    <div class="test-result">
                        <div class="test-header">
                            <div class="test-icon passed">✓</div>
                            <div class="test-content">
                                <div class="test-name">DKIM Key Presence</div>
                                <div class="test-message">Valid DKIM keys found for required selectors</div>
                                <div class="details-grid">
                                    <div class="detail-item">
                                        <div class="detail-label">Selectors Found</div>
                                        <div class="detail-value">google, default</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Key Algorithm</div>
                                        <div class="detail-value">RSA</div>
                                    </div>
                                </div>
                                <div class="test-references">
                                    <a href="https://tools.ietf.org/html/rfc6376" class="reference-link">RFC 6376</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="test-result">
                        <div class="test-header">
                            <div class="test-icon passed">✓</div>
                            <div class="test-content">
                                <div class="test-name">DKIM Key Length</div>
                                <div class="test-message">Key length meets security requirements (2048 bits)</div>
                                <div class="test-references">
                                    <a href="#" class="reference-link">M3AAWG DKIM Guide</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Domain 2 - Failed Example -->
        <div class="domain-results">
            <div class="domain-header">
                <div class="domain-title">
                    <div class="domain-name">subsidiary.example.com</div>
                    <div class="domain-status failed">FAILED</div>
                </div>
                <div style="margin-top: 10px; color: #6b7280;">
                    Production Domain • Last Updated: 1 day ago • 12 tests executed
                </div>
            </div>

            <!-- SPF Section - Failed -->
            <div class="protocol-section">
                <div class="protocol-header" onclick="toggleSection('spf-subsidiary')">
                    <div class="protocol-name">SPF (Sender Policy Framework)</div>
                    <div class="protocol-status">
                        <span class="status-badge failed">1 Failed</span>
                        <span class="status-badge warning">1 Warning</span>
                        <span class="chevron" id="chevron-spf-subsidiary">▶</span>
                    </div>
                </div>
                <div class="protocol-details" id="spf-subsidiary">
                    <div class="test-result">
                        <div class="test-header">
                            <div class="test-icon failed">✗</div>
                            <div class="test-content">
                                <div class="test-name">DNS Lookup Limit Exceeded</div>
                                <div class="test-message">SPF record exceeds 10 DNS lookup limit (13 lookups detected)</div>
                                <div class="details-grid">
                                    <div class="detail-item">
                                        <div class="detail-label">DNS Lookups</div>
                                        <div class="detail-value" style="color: #ef4444;">13 of 10 allowed</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Mechanisms</div>
                                        <div class="detail-value">6 includes, 4 a, 3 mx</div>
                                    </div>
                                </div>
                                <div class="test-recommendation">
                                    <div class="label">Recommendation:</div>
                                    <div class="text">Consolidate SPF includes or use SPF flattening to reduce DNS lookups. Consider using a single include that encompasses all your mail sources, or implement SPF macros for dynamic inclusion.</div>
                                </div>
                                <div class="test-references">
                                    <a href="https://tools.ietf.org/html/rfc7208#section-4.6.4" class="reference-link">RFC 7208 §4.6.4</a>
                                    <a href="#" class="reference-link">SPF Flattening Guide</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="test-result">
                        <div class="test-header">
                            <div class="test-icon warning">⚠</div>
                            <div class="test-content">
                                <div class="test-name">Soft Fail Mechanism</div>
                                <div class="test-message">SPF record uses soft fail (~all) instead of hard fail (-all)</div>
                                <div class="test-recommendation">
                                    <div class="label">Recommendation:</div>
                                    <div class="text">For production domains, consider upgrading to hard fail (-all) after ensuring all legitimate mail sources are included in your SPF record.</div>
                                </div>
                                <div class="test-references">
                                    <a href="https://tools.ietf.org/html/rfc7208#section-5.1" class="reference-link">RFC 7208 §5.1</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- DMARC Section - Missing -->
            <div class="protocol-section">
                <div class="protocol-header" onclick="toggleSection('dmarc-subsidiary')">
                    <div class="protocol-name">DMARC (Domain-based Message Authentication)</div>
                    <div class="protocol-status">
                        <span class="status-badge failed">1 Failed</span>
                        <span class="chevron" id="chevron-dmarc-subsidiary">▶</span>
                    </div>
                </div>
                <div class="protocol-details" id="dmarc-subsidiary">
                    <div class="test-result">
                        <div class="test-header">
                            <div class="test-icon failed">✗</div>
                            <div class="test-content">
                                <div class="test-name">DMARC Record Missing</div>
                                <div class="test-message">No DMARC record found for this domain</div>
                                <div class="test-recommendation">
                                    <div class="label">Recommendation:</div>
                                    <div class="text">Implement DMARC policy starting with p=none for monitoring, then gradually move to p=quarantine and finally p=reject. Create a _dmarc TXT record with appropriate RUA (aggregate reports) and RUF (forensic reports) endpoints.</div>
                                </div>
                                <div class="test-references">
                                    <a href="https://tools.ietf.org/html/rfc7489" class="reference-link">RFC 7489</a>
                                    <a href="https://dmarc.org/wiki/FAQ" class="reference-link">DMARC.org Deployment</a>
                                    <a href="#" class="reference-link">M3AAWG DMARC Guide</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Domain 3 - Parked Domain -->
        <div class="domain-results">
            <div class="domain-header">
                <div class="domain-title">
                    <div class="domain-name">unused.example.com</div>
                    <div class="domain-status passed">PASSED</div>
                </div>
                <div style="margin-top: 10px; color: #6b7280;">
                    Parked Domain • Classification: Non-Production • 4 tests executed
                </div>
            </div>

            <!-- MX Section - Null MX -->
            <div class="protocol-section">
                <div class="protocol-header" onclick="toggleSection('mx-unused')">
                    <div class="protocol-name">MX (Mail Exchange)</div>
                    <div class="protocol-status">
                        <span class="status-badge passed">1 Passed</span>
                        <span class="chevron" id="chevron-mx-unused">▶</span>
                    </div>
                </div>
                <div class="protocol-details" id="mx-unused">
                    <div class="test-result">
                        <div class="test-header">
                            <div class="test-icon passed">✓</div>
                            <div class="test-content">
                                <div class="test-name">Null MX Record</div>
                                <div class="test-message">Properly configured null MX record for parked domain</div>
                                <div class="details-grid">
                                    <div class="detail-item">
                                        <div class="detail-label">MX Record</div>
                                        <div class="detail-value">0 .</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Purpose</div>
                                        <div class="detail-value">Explicitly no mail</div>
                                    </div>
                                </div>
                                <div class="test-references">
                                    <a href="https://tools.ietf.org/html/rfc7505" class="reference-link">RFC 7505</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Other protocols skipped for parked domain -->
            <div class="protocol-section">
                <div class="protocol-header">
                    <div class="protocol-name">SPF/DKIM/DMARC</div>
                    <div class="protocol-status">
                        <span class="status-badge skipped">Skipped (Parked Domain)</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p><strong>Domain Compliance Framework v1.0.0</strong> | Powered by DomainDetective + Pester</p>
            <p>Generated using baseline email security test suite. For custom compliance requirements, contact your administrator.</p>
            <p style="margin-top: 10px; font-size: 0.8rem;">
                Test data gathered: September 4, 2025 | Report generated: September 4, 2025, 2:30 PM EDT
            </p>
        </div>

        <div class="back-to-top-wrapper">
            <a class="back-to-top" href="#main-content" aria-label="Back to the top of the report">↑ Back to top</a>
        </div>
    </div>

    <script>
        const setSectionState = (sectionId, expanded) => {
            const details = document.getElementById(sectionId);
            const chevron = document.getElementById('chevron-' + sectionId);
            if (!details) {
                return;
            }
            details.classList.toggle('expanded', expanded);
            if (chevron) {
                chevron.classList.toggle('expanded', expanded);
            }
        };

        const syncGlobalToggle = () => {
            const toggleButton = document.getElementById('toggle-all-sections');
            if (!toggleButton) {
                return;
            }
            const sections = Array.from(document.querySelectorAll('.protocol-details'));
            const allExpanded = sections.length > 0 && sections.every(section => section.classList.contains('expanded'));
            toggleButton.textContent = allExpanded ? 'Collapse all sections' : 'Expand all sections';
            toggleButton.setAttribute('aria-pressed', allExpanded ? 'true' : 'false');
        };

        function toggleSection(sectionId) {
            const details = document.getElementById(sectionId);
            if (!details) {
                return;
            }
            const shouldExpand = !details.classList.contains('expanded');
            setSectionState(sectionId, shouldExpand);
            syncGlobalToggle();
        }

        const setAllSections = (expanded) => {
            document.querySelectorAll('.protocol-details').forEach(section => {
                if (!section.id) {
                    return;
                }
                setSectionState(section.id, expanded);
            });
            syncGlobalToggle();
        };

        const initializeFailedSections = () => {
            const failedSections = document.querySelectorAll('.protocol-status .status-badge.failed');
            failedSections.forEach(function(badge) {
                const protocolHeader = badge.closest('.protocol-header');
                if (!protocolHeader) {
                    return;
                }
                const onclickValue = protocolHeader.getAttribute('onclick');
                if (!onclickValue) {
                    return;
                }
                const match = onclickValue.match(/'([^']+)'/);
                if (match && match[1]) {
                    setSectionState(match[1], true);
                }
            });
        };

        document.addEventListener('DOMContentLoaded', function() {
            const toggleAllButton = document.getElementById('toggle-all-sections');
            initializeFailedSections();
            if (toggleAllButton) {
                toggleAllButton.addEventListener('click', function() {
                    const sections = Array.from(document.querySelectorAll('.protocol-details'));
                    const allExpanded = sections.length > 0 && sections.every(section => section.classList.contains('expanded'));
                    setAllSections(!allExpanded);
                });
            }
            syncGlobalToggle();
        });
    </script>
</body>
</html>
